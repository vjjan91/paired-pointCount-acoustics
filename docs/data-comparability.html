<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Data comparability | Source code and supporting information for Predicting bird species abundances from acoustic data</title>
  <meta name="description" content="Section 4 Data comparability | Source code and supporting information for Predicting bird species abundances from acoustic data" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Data comparability | Source code and supporting information for Predicting bird species abundances from acoustic data" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="vjjan91/paired-pointCount-acoustics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Data comparability | Source code and supporting information for Predicting bird species abundances from acoustic data" />
  
  
  

<meta name="author" content="Vijay Ramesh" />
<meta name="author" content="Divya Mudappa" />
<meta name="author" content="T R Shankar Raman" />
<meta name="author" content="" />
<meta name="author" content="Laurel B Symes" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploring-outputs-from-birdnet.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html"><i class="fa fa-check"></i><b>2</b> Exploring point-count data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html#loading-point-count-data"><i class="fa fa-check"></i><b>2.1</b> Loading point-count data</a></li>
<li class="chapter" data-level="2.2" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html#load-site-level-information-and-create-gridded-data"><i class="fa fa-check"></i><b>2.2</b> Load site level information and create gridded data</a></li>
<li class="chapter" data-level="2.3" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html#extract-species-level-information"><i class="fa fa-check"></i><b>2.3</b> Extract species-level information</a></li>
<li class="chapter" data-level="2.4" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html#visualizing-richness-data-across-seasons"><i class="fa fa-check"></i><b>2.4</b> Visualizing richness data across seasons</a></li>
<li class="chapter" data-level="2.5" data-path="exploring-point-count-data.html"><a href="exploring-point-count-data.html#visualizing-abundance-by-species-across-seasons"><i class="fa fa-check"></i><b>2.5</b> Visualizing abundance by species across seasons</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-outputs-from-birdnet.html"><a href="exploring-outputs-from-birdnet.html"><i class="fa fa-check"></i><b>3</b> Exploring outputs from BirdNET</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exploring-outputs-from-birdnet.html"><a href="exploring-outputs-from-birdnet.html#install-required-libraries"><i class="fa fa-check"></i><b>3.1</b> Install required libraries</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-outputs-from-birdnet.html"><a href="exploring-outputs-from-birdnet.html#creating-a-custom-species-list-for-birdnet-analysis"><i class="fa fa-check"></i><b>3.2</b> Creating a custom species list for BirdNET analysis</a></li>
<li class="chapter" data-level="3.3" data-path="exploring-outputs-from-birdnet.html"><a href="exploring-outputs-from-birdnet.html#results-from-validating-the-birdnet-out-of-the-box-model"><i class="fa fa-check"></i><b>3.3</b> Results from validating the BirdNET out-of-the-box model</a></li>
<li class="chapter" data-level="3.4" data-path="exploring-outputs-from-birdnet.html"><a href="exploring-outputs-from-birdnet.html#setting-thresholds-for-species-after-validation"><i class="fa fa-check"></i><b>3.4</b> Setting thresholds for species after validation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-comparability.html"><a href="data-comparability.html"><i class="fa fa-check"></i><b>4</b> Data comparability</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-comparability.html"><a href="data-comparability.html#install-required-libraries-1"><i class="fa fa-check"></i><b>4.1</b> Install required libraries</a></li>
<li class="chapter" data-level="4.2" data-path="data-comparability.html"><a href="data-comparability.html#loading-the-acoustic-data-and-filtering-outputs-above-a-threshold"><i class="fa fa-check"></i><b>4.2</b> Loading the acoustic data and filtering outputs above a threshold</a></li>
<li class="chapter" data-level="4.3" data-path="data-comparability.html"><a href="data-comparability.html#loading-point-count-data-1"><i class="fa fa-check"></i><b>4.3</b> Loading point count data</a></li>
<li class="chapter" data-level="4.4" data-path="data-comparability.html"><a href="data-comparability.html#curating-the-acoustic-dataset-and-creating-a-new-object"><i class="fa fa-check"></i><b>4.4</b> Curating the acoustic dataset and creating a new object</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Source code and supporting information for <em>Predicting bird species abundances from acoustic data</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-comparability" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Section 4</span> Data comparability<a href="data-comparability.html#data-comparability" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this script, we extract acoustic detections from each audio file by using the curated thresholds that were set for BirdNET data and compare it with the cleaned point count dataset.</p>
<div id="install-required-libraries-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Install required libraries<a href="data-comparability.html#install-required-libraries-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-comparability.html#cb10-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-2"><a href="data-comparability.html#cb10-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-3"><a href="data-comparability.html#cb10-3" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb10-4"><a href="data-comparability.html#cb10-4" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-5"><a href="data-comparability.html#cb10-5" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb10-6"><a href="data-comparability.html#cb10-6" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb10-7"><a href="data-comparability.html#cb10-7" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb10-8"><a href="data-comparability.html#cb10-8" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb10-9"><a href="data-comparability.html#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="data-comparability.html#cb10-10" tabindex="-1"></a><span class="co"># for plotting</span></span>
<span id="cb10-11"><a href="data-comparability.html#cb10-11" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb10-12"><a href="data-comparability.html#cb10-12" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb10-13"><a href="data-comparability.html#cb10-13" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb10-14"><a href="data-comparability.html#cb10-14" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb10-15"><a href="data-comparability.html#cb10-15" tabindex="-1"></a><span class="fu">library</span>(scico)</span>
<span id="cb10-16"><a href="data-comparability.html#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="data-comparability.html#cb10-17" tabindex="-1"></a><span class="co"># Source any custom/other internal functions necessary for analysis</span></span>
<span id="cb10-18"><a href="data-comparability.html#cb10-18" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;code/01_internal-functions.R&quot;</span>)</span></code></pre></div>
</div>
<div id="loading-the-acoustic-data-and-filtering-outputs-above-a-threshold" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Loading the acoustic data and filtering outputs above a threshold<a href="data-comparability.html#loading-the-acoustic-data-and-filtering-outputs-above-a-threshold" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous script, we created curated thresholds for each species above which the probability of detecting a species is at 0.95. For a few species for which the detector performed really well (proportion of true positives: false positives &gt; 0.95), we set a random threshold value of 0.25 above which we expect the probability of species detected to be greater than or equal to 0.95.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-comparability.html#cb11-1" tabindex="-1"></a><span class="do">## curate species thresholds</span></span>
<span id="cb11-2"><a href="data-comparability.html#cb11-2" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;results/curatedThresholds-species-list.csv&quot;</span>)</span>
<span id="cb11-3"><a href="data-comparability.html#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="data-comparability.html#cb11-4" tabindex="-1"></a><span class="do">## load the BirdNET output file</span></span>
<span id="cb11-5"><a href="data-comparability.html#cb11-5" tabindex="-1"></a>birdnet_results <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;results/birdNET-outputs/BirdNET_CombinedTable.csv&quot;</span>)</span>
<span id="cb11-6"><a href="data-comparability.html#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="data-comparability.html#cb11-7" tabindex="-1"></a><span class="do">## filter species detections above the threshold we chose</span></span>
<span id="cb11-8"><a href="data-comparability.html#cb11-8" tabindex="-1"></a><span class="do">## include a gridID column so that we can join this with the point_count data</span></span>
<span id="cb11-9"><a href="data-comparability.html#cb11-9" tabindex="-1"></a>birdnet_subset <span class="ot">&lt;-</span> birdnet_results <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="data-comparability.html#cb11-10" tabindex="-1"></a>    <span class="fu">inner_join</span>(threshold, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Common.name&quot;</span> <span class="ot">=</span> <span class="st">&quot;species&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="data-comparability.html#cb11-11" tabindex="-1"></a>    <span class="fu">filter</span>(Confidence <span class="sc">&gt;=</span> threshold) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="data-comparability.html#cb11-12" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">filename_pattern =</span> <span class="fu">basename</span>(File) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="data-comparability.html#cb11-13" tabindex="-1"></a>                        <span class="fu">sub</span>(<span class="st">&quot;.*</span><span class="sc">\\\\</span><span class="st">([0-9]{8}_[0-9]{4}_[A-Z0-9]+)</span><span class="sc">\\</span><span class="st">.WAV&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, .)) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="data-comparability.html#cb11-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">substr</span>(filename_pattern, <span class="dv">1</span>, <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="data-comparability.html#cb11-15" tabindex="-1"></a>             <span class="fu">ymd</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="data-comparability.html#cb11-16" tabindex="-1"></a>             <span class="fu">format</span>(<span class="st">&quot;%Y-%b-%d&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="data-comparability.html#cb11-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gridID =</span> <span class="fu">substr</span>(filename_pattern, <span class="dv">15</span>, <span class="fu">nchar</span>(filename_pattern)) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="data-comparability.html#cb11-18" tabindex="-1"></a>               <span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.WAV$&quot;</span>, <span class="st">&quot;&quot;</span>, .))</span></code></pre></div>
</div>
<div id="loading-point-count-data-1" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Loading point count data<a href="data-comparability.html#loading-point-count-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-comparability.html#cb12-1" tabindex="-1"></a>point_count <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;results/cleaned-point-count-data.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="curating-the-acoustic-dataset-and-creating-a-new-object" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Curating the acoustic dataset and creating a new object<a href="data-comparability.html#curating-the-acoustic-dataset-and-creating-a-new-object" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-comparability.html#cb13-1" tabindex="-1"></a><span class="co"># use only a subset of the birdnet_subset columns for the new object</span></span>
<span id="cb13-2"><a href="data-comparability.html#cb13-2" tabindex="-1"></a>acoustic_data <span class="ot">&lt;-</span> birdnet_subset[,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">10</span>)]</span>
<span id="cb13-3"><a href="data-comparability.html#cb13-3" tabindex="-1"></a><span class="fu">names</span>(acoustic_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;scientific_name&quot;</span>,<span class="st">&quot;common_name&quot;</span>,</span>
<span id="cb13-4"><a href="data-comparability.html#cb13-4" tabindex="-1"></a>                          <span class="st">&quot;date&quot;</span>, <span class="st">&quot;gridID&quot;</span>)</span>
<span id="cb13-5"><a href="data-comparability.html#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="data-comparability.html#cb13-6" tabindex="-1"></a><span class="co"># summarise and group the data based on the four columns and create a number column that indicates the number of acoustic detections</span></span>
<span id="cb13-7"><a href="data-comparability.html#cb13-7" tabindex="-1"></a>acoustic_data <span class="ot">&lt;-</span>  acoustic_data <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="data-comparability.html#cb13-8" tabindex="-1"></a>  <span class="fu">group_by</span>(scientific_name, common_name, date, gridID) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="data-comparability.html#cb13-9" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">number =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="data-comparability.html#cb13-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-11"><a href="data-comparability.html#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="data-comparability.html#cb13-12" tabindex="-1"></a><span class="co"># create a new column to indicate dateType</span></span>
<span id="cb13-13"><a href="data-comparability.html#cb13-13" tabindex="-1"></a>acoustic_data <span class="ot">&lt;-</span>  acoustic_data <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="data-comparability.html#cb13-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dataType =</span> <span class="st">&quot;acoustic_data&quot;</span>)</span>
<span id="cb13-15"><a href="data-comparability.html#cb13-15" tabindex="-1"></a>point_count <span class="ot">&lt;-</span> point_count <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="data-comparability.html#cb13-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dataType =</span> <span class="st">&quot;point_count&quot;</span>)</span>
<span id="cb13-17"><a href="data-comparability.html#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="data-comparability.html#cb13-18" tabindex="-1"></a><span class="co"># join with point_count data (remove the birdMamm column since all the data we are dealing with is bird data)</span></span>
<span id="cb13-19"><a href="data-comparability.html#cb13-19" tabindex="-1"></a>datSubset <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(point_count[,<span class="sc">-</span><span class="dv">6</span>], acoustic_data)</span>
<span id="cb13-20"><a href="data-comparability.html#cb13-20" tabindex="-1"></a></span>
<span id="cb13-21"><a href="data-comparability.html#cb13-21" tabindex="-1"></a><span class="co"># based on differences in taxonomy updates done by BirdNET and the eBird team and the species that we are currently analyzing, the Greater Flameback needs to be changed to Malabar Flameback along with it&#39;s scientific name</span></span>
<span id="cb13-22"><a href="data-comparability.html#cb13-22" tabindex="-1"></a><span class="co"># note: VR also had to manually edit the cleaned-point-data.csv to match older scientific names that are currently accepted by BirdNET</span></span>
<span id="cb13-23"><a href="data-comparability.html#cb13-23" tabindex="-1"></a></span>
<span id="cb13-24"><a href="data-comparability.html#cb13-24" tabindex="-1"></a>datSubset <span class="ot">&lt;-</span> datSubset <span class="sc">%&gt;%</span></span>
<span id="cb13-25"><a href="data-comparability.html#cb13-25" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-26"><a href="data-comparability.html#cb13-26" tabindex="-1"></a>    <span class="at">common_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-27"><a href="data-comparability.html#cb13-27" tabindex="-1"></a>      common_name <span class="sc">==</span> <span class="st">&quot;Greater Flameback&quot;</span> <span class="sc">~</span> <span class="st">&quot;Malabar Flameback&quot;</span>,</span>
<span id="cb13-28"><a href="data-comparability.html#cb13-28" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> common_name</span>
<span id="cb13-29"><a href="data-comparability.html#cb13-29" tabindex="-1"></a>    ),</span>
<span id="cb13-30"><a href="data-comparability.html#cb13-30" tabindex="-1"></a>    <span class="at">scientific_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-31"><a href="data-comparability.html#cb13-31" tabindex="-1"></a>      scientific_name <span class="sc">==</span> <span class="st">&quot;Chrysocolaptes guttacristatus&quot;</span> <span class="sc">~</span> <span class="st">&quot;Chrysocolaptes socialis&quot;</span>,</span>
<span id="cb13-32"><a href="data-comparability.html#cb13-32" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> scientific_name</span>
<span id="cb13-33"><a href="data-comparability.html#cb13-33" tabindex="-1"></a>    )</span>
<span id="cb13-34"><a href="data-comparability.html#cb13-34" tabindex="-1"></a>  )</span>
<span id="cb13-35"><a href="data-comparability.html#cb13-35" tabindex="-1"></a></span>
<span id="cb13-36"><a href="data-comparability.html#cb13-36" tabindex="-1"></a><span class="co"># let&#39;s fill in missing rows for seasonYear and start_time</span></span>
<span id="cb13-37"><a href="data-comparability.html#cb13-37" tabindex="-1"></a>datSubset <span class="ot">&lt;-</span> datSubset <span class="sc">%&gt;%</span></span>
<span id="cb13-38"><a href="data-comparability.html#cb13-38" tabindex="-1"></a>  <span class="fu">group_by</span>(date, gridID) <span class="sc">%&gt;%</span></span>
<span id="cb13-39"><a href="data-comparability.html#cb13-39" tabindex="-1"></a><span class="co"># fill(start_time, .direction = &quot;downup&quot;) %&gt;%</span></span>
<span id="cb13-40"><a href="data-comparability.html#cb13-40" tabindex="-1"></a>  <span class="fu">fill</span>(seasonYear, <span class="at">.direction =</span> <span class="st">&quot;downup&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-41"><a href="data-comparability.html#cb13-41" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-42"><a href="data-comparability.html#cb13-42" tabindex="-1"></a></span>
<span id="cb13-43"><a href="data-comparability.html#cb13-43" tabindex="-1"></a><span class="co"># change structures before writing to file</span></span>
<span id="cb13-44"><a href="data-comparability.html#cb13-44" tabindex="-1"></a>datSubset<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="fu">as.character</span>(datSubset<span class="sc">$</span>start_time)</span>
<span id="cb13-45"><a href="data-comparability.html#cb13-45" tabindex="-1"></a>datSubset<span class="sc">$</span>timeSeg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(datSubset<span class="sc">$</span>timeSeg)</span>
<span id="cb13-46"><a href="data-comparability.html#cb13-46" tabindex="-1"></a></span>
<span id="cb13-47"><a href="data-comparability.html#cb13-47" tabindex="-1"></a><span class="co"># rename columns</span></span>
<span id="cb13-48"><a href="data-comparability.html#cb13-48" tabindex="-1"></a><span class="fu">names</span>(datSubset)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;year_season&quot;</span></span>
<span id="cb13-49"><a href="data-comparability.html#cb13-49" tabindex="-1"></a><span class="fu">names</span>(datSubset)[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;time_segment&quot;</span></span>
<span id="cb13-50"><a href="data-comparability.html#cb13-50" tabindex="-1"></a></span>
<span id="cb13-51"><a href="data-comparability.html#cb13-51" tabindex="-1"></a><span class="co"># lastly, before writing the data locally, we only keep those species that are present in the curated birdNet thresholds species list and ignore those found only in point_count data and not in acoustic_data</span></span>
<span id="cb13-52"><a href="data-comparability.html#cb13-52" tabindex="-1"></a></span>
<span id="cb13-53"><a href="data-comparability.html#cb13-53" tabindex="-1"></a><span class="co"># filter the entire dataframe to keep only those species in the species_thresholds list</span></span>
<span id="cb13-54"><a href="data-comparability.html#cb13-54" tabindex="-1"></a><span class="fu">names</span>(threshold)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;common_name&quot;</span></span>
<span id="cb13-55"><a href="data-comparability.html#cb13-55" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> threshold <span class="sc">%&gt;%</span></span>
<span id="cb13-56"><a href="data-comparability.html#cb13-56" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-57"><a href="data-comparability.html#cb13-57" tabindex="-1"></a>    <span class="at">common_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-58"><a href="data-comparability.html#cb13-58" tabindex="-1"></a>      common_name <span class="sc">==</span> <span class="st">&quot;Greater Flameback&quot;</span> <span class="sc">~</span> <span class="st">&quot;Malabar Flameback&quot;</span>,</span>
<span id="cb13-59"><a href="data-comparability.html#cb13-59" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> common_name</span>
<span id="cb13-60"><a href="data-comparability.html#cb13-60" tabindex="-1"></a>    ))</span>
<span id="cb13-61"><a href="data-comparability.html#cb13-61" tabindex="-1"></a></span>
<span id="cb13-62"><a href="data-comparability.html#cb13-62" tabindex="-1"></a><span class="co"># filter those species</span></span>
<span id="cb13-63"><a href="data-comparability.html#cb13-63" tabindex="-1"></a><span class="co"># we only retain 44 species of the initial list of 107 that were detected in point_counts </span></span>
<span id="cb13-64"><a href="data-comparability.html#cb13-64" tabindex="-1"></a>datSubset <span class="ot">&lt;-</span> datSubset <span class="sc">%&gt;%</span></span>
<span id="cb13-65"><a href="data-comparability.html#cb13-65" tabindex="-1"></a>  <span class="fu">filter</span>(common_name <span class="sc">%in%</span> threshold<span class="sc">$</span>common_name)</span>
<span id="cb13-66"><a href="data-comparability.html#cb13-66" tabindex="-1"></a></span>
<span id="cb13-67"><a href="data-comparability.html#cb13-67" tabindex="-1"></a><span class="co"># write to file</span></span>
<span id="cb13-68"><a href="data-comparability.html#cb13-68" tabindex="-1"></a><span class="fu">write.csv</span>(datSubset, <span class="st">&quot;results/datSubset.csv&quot;</span>, <span class="at">row.names =</span> F)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploring-outputs-from-birdnet.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/paired-pointCount-acoustics/edit/master/03_data-comparability.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
